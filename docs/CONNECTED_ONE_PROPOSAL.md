# コネクティッドワン担当者様へ - ヒートマップツール統合のご確認

## ご挨拶

いつもお世話になっております。

この度、コネクティッドワンのユーザー向けに**ヒートマップ & ファネル解析ツール**を開発しております。

つきましては、統合方式について貴社の見解をお伺いしたく、本ドキュメントをお送りいたします。

---

## 📋 目次

1. [開発中のツール概要](#1-開発中のツール概要)
2. [発生した問題](#2-発生した問題)
3. [検討した解決策](#3-検討した解決策)
4. [採用予定の方式](#4-採用予定の方式gtm統合)
5. [貴社へのご確認事項](#5-貴社へのご確認事項)
6. [参考資料](#6-参考資料)

---

## 1. 開発中のツール概要

### 1.1 ツールの目的

コネクティッドワンで作成したLP（ランディングページ）のユーザー行動を可視化し、CVR改善に役立てるツールです。

### 1.2 主要機能

- **クリックヒートマップ**: ユーザーのクリック位置を可視化
- **スクロールヒートマップ**: ページのスクロール深度を計測
- **ファネル解析**: ステップ間の遷移率・離脱率を分析

### 1.3 ターゲットユーザー

- コネクティッドワンユーザー（マーケター、個人起業家、LP運営者）
- 自社LPに訪れたエンドユーザーの行動を分析したい方

### 1.4 技術仕様

- **形式**: JavaScriptライブラリ（9.30KB gzip圧縮後）
- **データ保存**: ブラウザのLocalStorage（サーバーレス）
- **配信**: Vercel CDN経由
- **維持費**: ゼロ（完全無料）

---

## 2. 発生した問題

### 2.1 問題の詳細

コネクティッドワンのページビルダーで、**カスタムJavaScriptコードが保存できない**ことが判明しました。

### 2.2 試行した方法（すべて失敗）

以下の場所でJavaScript（`<script>`タグ）の貼り付けを試みましたが、すべて保存できませんでした:

| 試行箇所 | 結果 |
|---------|------|
| ページヘッダーマークアップ | ❌ 保存不可 |
| ページボディマークアップ | ❌ 保存不可 |
| ページフッターマークアップ | ❌ 保存不可 |
| HTMLブロック（ウィジェット） | ❌ 保存不可 |

### 2.3 保存できたもの

- ✅ Googleタグマネージャー（GTM）のコード
- ✅ Facebookピクセルのコード
- ✅ その他、ホワイトリスト登録済みと思われるツール

### 2.4 推測される原因

セキュリティ上の理由から、コネクティッドワンは**ホワイトリスト方式**でJavaScriptの保存を制限していると推測されます。

---

## 3. 検討した解決策

以下の3つの方式を検討しました:

### 案1: Googleタグマネージャー（GTM）経由で配信 ✅ 採用予定

**概要:**
- コネワンでGTMコンテナを読み込み（✅保存可能）
- GTM側でヒートマップライブラリを配信

**メリット:**
- ✅ コネワンで確実に保存できる（GTMは許可済み）
- ✅ エンドユーザー全員のデータ収集が可能
- ✅ 規約違反リスクなし（正攻法）
- ✅ 維持費ゼロ

**デメリット:**
- ⚠ お客様にGTMアカウント作成を依頼する必要あり

---

### 案2: Chrome拡張機能で自動注入 ❌ 不採用

**概要:**
- ブラウザ拡張機能でスクリプトを自動注入

**不採用の理由:**
- ❌ エンドユーザーのデータが取れない（拡張機能をインストールした人のみ）
- ❌ お客様全員に拡張機能のインストールを依頼する必要あり

---

### 案3: リバースプロキシ（Cloudflare Workers）でスクリプト注入 ❌ 不採用

**概要:**
- お客様の独自ドメインをプロキシ経由にしてスクリプト自動注入

**不採用の理由:**
- ❌ コネクティッドワンの規約に抵触する可能性
- ⚠ DNS設定変更が必要（技術的ハードルが高い）
- ⚠ トラブル時のサポート負担が大きい

---

## 4. 採用予定の方式（GTM統合）

### 4.1 アーキテクチャ

```
┌─────────────────────────────────────────┐
│  コネクティッドワンLP                      │
│  (お客様が作成したページ)                  │
│                                         │
│  <script src="GTM-XXXXXXX"></script>    │
│  ↑ Googleタグ欄に貼り付け（✅保存可能）   │
└─────────────────────────────────────────┘
                ↓
┌─────────────────────────────────────────┐
│  Googleタグマネージャー（GTM）              │
│  (Googleが提供する無料ツール)               │
│                                         │
│  カスタムHTMLタグでヒートマップを配信       │
└─────────────────────────────────────────┘
                ↓
┌─────────────────────────────────────────┐
│  Vercel CDN                             │
│  (ヒートマップライブラリ: 9.30KB)          │
└─────────────────────────────────────────┘
                ↓
        エンドユーザーのデータ収集
```

### 4.2 お客様の作業フロー

1. **GTMアカウント作成**（5分、無料）
   - https://tagmanager.google.com/ でアカウント作成

2. **GTMコンテナIDを取得**
   - 例: `GTM-ABC1234`

3. **コネワンの「Googleタグ」欄に貼り付け**
   - ✅ これは保存できることを確認済み

4. **弊社がGTM側で設定完了**（お客様の追加作業なし）

5. **完了！エンドユーザーのデータが自動収集されます**

### 4.3 コネクティッドワンへの影響

- ✅ **既存機能への影響なし**: GTMは既にサポート済みのツール
- ✅ **サーバー負荷なし**: ヒートマップデータはクライアント側（LocalStorage）に保存
- ✅ **セキュリティリスクなし**: GTMはGoogleが提供する信頼済みツール
- ✅ **お客様のページ速度への影響**: 最小限（ライブラリは9.30KBのみ）

---

## 5. 貴社へのご確認事項

### 5.1 主要な確認事項

以下の点についてご確認をお願いいたします:

#### ✅ 確認1: GTM統合方式の利用可否

**質問:**
> Googleタグマネージャー（GTM）経由でヒートマップライブラリを配信する方式は、コネクティッドワンの利用規約上、問題ございませんか？

**補足:**
- GTMコンテナは既にコネワンで保存可能（ホワイトリスト登録済みと推測）
- GTM側でカスタムHTMLタグを使用してヒートマップを配信
- エンドユーザーのブラウザで実行されるJavaScriptライブラリ

---

#### ✅ 確認2: カスタムJavaScript保存制限の仕様

**質問:**
> コネクティッドワンのページビルダーでカスタムJavaScript（`<script>`タグ）が保存できない仕様について、以下をご教示ください:

1. **制限の目的**: セキュリティ上の理由で正しいでしょうか？
2. **ホワイトリスト**: 現在、どのツール/ドメインがホワイトリスト登録されていますか？
3. **ホワイトリスト申請**: 弊社のVercel CDN（`https://heat-cvnvx2ln9-masamitakatani-4585s-projects.vercel.app/`）をホワイトリストに追加していただくことは可能でしょうか？

**補足:**
- ホワイトリスト追加が可能な場合、GTM不要で直接スクリプトタグが使用可能
- お客様の手間が大幅に削減される

---

#### ✅ 確認3: 代替方法のご提案

**質問:**
> もし上記の方式が規約上問題がある場合、貴社から推奨される統合方法はございますか？

**例:**
- 公式プラグイン/拡張機能としての提供
- 外部ツール連携APIの利用
- その他の統合方法

---

### 5.2 追加の確認事項（任意）

#### 参考情報として

以下についても、もしご教示いただければ幸いです:

1. **他社ツールの統合事例**: Google Analytics、Facebook Pixel以外に、コネワンと統合されている解析ツールはありますか？
2. **公式連携プログラム**: コネクティッドワンに公式パートナープログラムや拡張機能マーケットプレイスのご予定はありますか？
3. **技術ドキュメント**: ページビルダーのセキュリティポリシーや、JavaScriptホワイトリストに関する公式ドキュメントはありますか？

---

## 6. 参考資料

### 6.1 添付ドキュメント

本ドキュメントと合わせて、以下の資料をご確認ください:

1. **要件定義書** (`requirements.md`)
   - ツールの詳細仕様
   - GTM統合仕様（セクション12）

2. **GTM統合ガイド** (`GTM_INTEGRATION.md`)
   - 技術的な実装詳細
   - アーキテクチャ図

3. **お客様向けマニュアル** (`CUSTOMER_MANUAL.md`)
   - GTM統合の手順書
   - トラブルシューティング

4. **GTMコードサンプル** (`gtm-codes/`)
   - 実際に使用するカスタムHTMLタグのコード

### 6.2 デモページ

実際の動作を確認できるデモページ:
- https://heat-cvnvx2ln9-masamitakatani-4585s-projects.vercel.app/
  （※現在はスタンドアロンデモ。GTM統合版は貴社の許可後に実装予定）

### 6.3 ライブラリ情報

- **CDN URL**: `https://heat-cvnvx2ln9-masamitakatani-4585s-projects.vercel.app/heatmap-analytics.umd.js`
- **ファイルサイズ**: 9.30KB（gzip圧縮後）
- **ホスティング**: Vercel（無料枠）
- **ソースコード**: TypeScript（厳密型チェック済み）

---

## 7. 今後の流れ

### 7.1 ご回答後の対応

貴社からのご回答を受け、以下のいずれかで進めさせていただきます:

#### パターンA: GTM統合が問題ない場合

1. ✅ GTM統合方式で実装を完了
2. ✅ お客様向けマニュアルを整備
3. ✅ コネワンユーザーへ提供開始

#### パターンB: ホワイトリスト追加が可能な場合

1. ✅ Vercel CDNをホワイトリストに追加いただく
2. ✅ 直接スクリプトタグで統合（GTM不要）
3. ✅ お客様の手間が最小化

#### パターンC: 代替方法のご提案をいただいた場合

1. ✅ ご提案いただいた方式で再設計
2. ✅ 実装完了後に再度ご確認
3. ✅ 提供開始

### 7.2 スケジュール（想定）

- **貴社ご回答**: 〜 ○○月○○日（ご都合に合わせます）
- **実装完了**: ご回答から1週間以内
- **提供開始**: 実装完了後、即時

---

## 8. お問い合わせ先

本件に関するご質問は、以下までお気軽にお問い合わせください。

**担当者**: [あなたのお名前]
**メール**: [あなたのメールアドレス]
**電話**: [あなたの電話番号]（任意）

---

## 9. 補足事項

### 9.1 コンプライアンス

- ✅ **個人情報保護**: クリック座標のみ記録（個人を特定できる情報は一切記録しません）
- ✅ **データ保存**: クライアント側（LocalStorage）のみ（サーバーにデータ送信なし）
- ✅ **維持費**: 完全無料（コネワンユーザーに課金なし）

### 9.2 記録される情報

| 記録する | 記録しない |
|---------|-----------|
| ✅ クリック座標 | ❌ 名前・メールアドレス |
| ✅ スクロール位置 | ❌ IPアドレス |
| ✅ ページURL | ❌ 入力フィールドの内容 |
| ✅ 匿名化セッションID | ❌ Cookie情報 |

### 9.3 セキュリティ対策

- ✅ **XSS対策**: ユーザー入力のサニタイズ実装済み
- ✅ **CORS対応**: クロスドメイン通信を安全に実行
- ✅ **TypeScript**: 型安全な実装で脆弱性を最小化

---

## 10. まとめ

### 10.1 お願い事項

以下についてご確認をお願いいたします:

1. ✅ **GTM統合方式の利用可否**
2. ✅ **カスタムJavaScript保存制限の仕様**
3. ✅ **ホワイトリスト申請の可否**（可能な場合）

### 10.2 期待する成果

- コネワンユーザーがヒートマップツールを気軽に利用できる
- LP改善によるCVR向上を支援
- コネクティッドワンのエコシステムがより強力に

---

お忙しいところ恐縮ですが、ご確認のほどよろしくお願いいたします。

何かご不明点がございましたら、お気軽にお問い合わせください。

---

**作成日**: 2025年11月3日
**バージョン**: 1.0
**作成者**: [あなたのお名前]
**連絡先**: [あなたのメールアドレス]
