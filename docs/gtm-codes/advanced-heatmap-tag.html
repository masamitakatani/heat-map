<!-- GTM ã‚«ã‚¹ã‚¿ãƒ HTMLã‚¿ã‚° - ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºç‰ˆï¼‰ -->
<!-- ã“ã®ã‚³ãƒ¼ãƒ‰ã‚’Googleã‚¿ã‚°ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®ã€Œã‚«ã‚¹ã‚¿ãƒ HTMLã€ã‚¿ã‚°ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ -->

<script>
(function() {
  'use strict';

  // ========================================
  // ğŸ“ ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºè¨­å®š
  // ========================================
  var CONFIG = {
    // ãŠå®¢æ§˜ã”ã¨ã«å›ºæœ‰ã®APIã‚­ãƒ¼ã‚’è¨­å®š
    apiKey: 'gtm-integration-customer-001',

    // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIDï¼ˆãŠå®¢æ§˜è­˜åˆ¥ç”¨ï¼‰
    // 'auto' ã®å ´åˆã€ãƒ‰ãƒ¡ã‚¤ãƒ³åã‹ã‚‰è‡ªå‹•ç”Ÿæˆï¼ˆä¾‹: gambit.icu â†’ gambit-icuï¼‰
    projectId: 'auto',

    // ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ï¼ˆæœ¬ç•ªç’°å¢ƒã§ã¯ false ã«ã—ã¦ãã ã•ã„ï¼‰
    debug: true,

    // è‡ªå‹•é–‹å§‹ï¼ˆé€šå¸¸ã¯ true ã®ã¾ã¾ã§ OKï¼‰
    autoStart: true,

    // APIãƒ™ãƒ¼ã‚¹URLï¼ˆé€šå¸¸ã¯å¤‰æ›´ä¸è¦ï¼‰
    baseUrl: 'https://api.connected-one.com/v1'
  };
  // ========================================

  // æ—¢ã«èª­ã¿è¾¼ã¿æ¸ˆã¿ã®å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—
  if (window.HeatmapAnalytics) {
    console.log('âš ï¸ ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯æ—¢ã«èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã™');
    return;
  }

  // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIDã®è‡ªå‹•ç”Ÿæˆ
  var projectId = CONFIG.projectId === 'auto'
    ? window.location.hostname.replace(/\./g, '-')
    : CONFIG.projectId;

  // ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å‹•çš„ã«èª­ã¿è¾¼ã‚€
  var script = document.createElement('script');
  script.src = 'https://heat-cvnvx2ln9-masamitakatani-4585s-projects.vercel.app/heatmap-analytics.umd.js';
  script.async = true;

  script.onload = function() {
    if (CONFIG.debug) {
      console.log('âœ… ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ãƒ©ã‚¤ãƒ–ãƒ©ãƒªèª­ã¿è¾¼ã¿å®Œäº†');
    }

    // åˆæœŸåŒ–
    try {
      var tracker = new window.HeatmapAnalytics({
        api: {
          apiKey: CONFIG.apiKey,
          projectId: projectId,
          baseUrl: CONFIG.baseUrl
        },
        debug: CONFIG.debug,
        autoStart: CONFIG.autoStart,
      });

      tracker.init();
      window.heatmapTracker = tracker;

      if (CONFIG.debug) {
        console.log('âœ… ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—åˆæœŸåŒ–å®Œäº†');
        console.log('ğŸ“Š Session ID:', tracker.getSessionId());
        console.log('ğŸ‘¤ Anonymous ID:', tracker.getAnonymousId());
        console.log('ğŸ”§ API Key:', CONFIG.apiKey);
        console.log('ğŸ“ Project ID:', projectId);
      }

      // ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ™ãƒ³ãƒˆé€ä¿¡ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
      // GTMã®ãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«é€šçŸ¥
      if (window.dataLayer) {
        window.dataLayer.push({
          'event': 'heatmap_initialized',
          'heatmap_session_id': tracker.getSessionId(),
          'heatmap_anonymous_id': tracker.getAnonymousId()
        });
      }

    } catch (error) {
      console.error('âŒ ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);

      // ã‚¨ãƒ©ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆé€ä¿¡ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
      if (window.dataLayer) {
        window.dataLayer.push({
          'event': 'heatmap_init_error',
          'error_message': error.message
        });
      }
    }
  };

  script.onerror = function() {
    console.error('âŒ ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');

    // ã‚¨ãƒ©ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆé€ä¿¡ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
    if (window.dataLayer) {
      window.dataLayer.push({
        'event': 'heatmap_load_error'
      });
    }
  };

  document.head.appendChild(script);
})();
</script>
